{% extends "base.html" %}

{% block title %}Settings - Whale Wallet{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Settings</h1>
        <p class="page-subtitle">Security configuration and account settings</p>
    </div>
</div>

<div class="grid grid-2">
    <!-- Left Column -->
    <div class="flex flex-col gap-lg">
        <!-- Account Info -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Account</h3>
                <span class="badge badge-primary">Humpback Tier</span>
            </div>
            <div class="flex flex-col gap-md">
                <div class="flex justify-between items-center">
                    <span class="text-secondary">Email</span>
                    <span>whale@example.com</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-secondary">User ID</span>
                    <span class="mono">usr_demo123456789</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-secondary">Member Since</span>
                    <span>January 2026</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-secondary">Tier Benefits</span>
                    <span>0% swap fees, advanced policies</span>
                </div>
            </div>
        </div>

        <!-- MPC Key Status -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">MPC Key Status</h3>
                <span class="badge badge-success">Healthy</span>
            </div>
            <div class="mpc-status mb-lg" style="justify-content: space-around;">
                <div class="mpc-shard">
                    <div class="mpc-shard-icon active">üì±</div>
                    <span class="mpc-shard-label">Mobile</span>
                    <span class="text-xs text-success">Active</span>
                </div>
                <div class="mpc-shard">
                    <div class="mpc-shard-icon active">‚òÅÔ∏è</div>
                    <span class="mpc-shard-label">Server</span>
                    <span class="text-xs text-success">Active</span>
                </div>
                <div class="mpc-shard">
                    <div class="mpc-shard-icon active">üîë</div>
                    <span class="mpc-shard-label">Recovery</span>
                    <span class="text-xs text-success">Active</span>
                </div>
            </div>
            <div class="flex flex-col gap-sm mb-lg">
                <div class="flex justify-between">
                    <span class="text-secondary">Last Key Rotation</span>
                    <span>30 days ago</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-secondary">Next Recommended</span>
                    <span class="text-warning">60 days</span>
                </div>
            </div>
            <button class="btn btn-secondary" style="width: 100%;" onclick="rotateKeys()">
                üîÑ Initiate Key Rotation
            </button>
        </div>

        <!-- Duress Mode -->
        <div class="card" style="border-left: 3px solid var(--color-error);">
            <div class="card-header">
                <h3 class="card-title">üö® Duress Mode</h3>
                <span class="badge badge-primary">Configured</span>
            </div>
            <p class="text-secondary mb-lg">
                If you're ever under physical coercion, enter your duress PIN instead of your normal PIN.
                This will show a decoy wallet while silently alerting your contacts.
            </p>
            <div class="flex flex-col gap-sm mb-lg">
                <div class="flex justify-between">
                    <span class="text-secondary">Decoy Wallet Balance</span>
                    <span>$5,432.10</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-secondary">Alert Contacts</span>
                    <span>3 configured</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-secondary">Status</span>
                    <span class="text-success">Ready</span>
                </div>
            </div>
            <button class="btn btn-secondary" style="width: 100%;" onclick="configureDuress()">
                Configure Duress Mode
            </button>
        </div>
    </div>

    <!-- Right Column -->
    <div class="flex flex-col gap-lg">
        <!-- Inheritance / Dead Man's Switch -->
        <div class="card" style="border-left: 3px solid var(--color-warning);">
            <div class="card-header">
                <h3 class="card-title">‚ö∞Ô∏è Inheritance Protocol</h3>
                <span class="badge badge-success">Active</span>
            </div>
            <p class="text-secondary mb-lg">
                Dead Man's Switch ensures your assets pass to your heirs if you don't authenticate for an extended
                period.
            </p>
            <div class="flex flex-col gap-sm mb-lg">
                <div class="flex justify-between">
                    <span class="text-secondary">Last Ping</span>
                    <span class="text-success">Just now</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-secondary">Inactivity Threshold</span>
                    <span>180 days</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-secondary">Days Until Trigger</span>
                    <span>180</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-secondary">Guardians Configured</span>
                    <span>3 of 5</span>
                </div>
            </div>
            <div class="flex gap-md">
                <button class="btn btn-primary" style="flex: 1;" onclick="pingInheritance()">
                    ‚úì Ping Now
                </button>
                <button class="btn btn-secondary" style="flex: 1;" onclick="configureInheritance()">
                    Configure
                </button>
            </div>
        </div>

        <!-- Security Preferences -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Security Preferences</h3>
            </div>
            <div class="flex flex-col gap-md">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="font-medium">Biometric Authentication</p>
                        <p class="text-sm text-muted">Require Face ID / fingerprint</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider"></span>
                    </label>
                </div>

                <div style="border-top: 1px solid var(--color-border); padding-top: var(--space-md);">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Transaction Simulation</p>
                            <p class="text-sm text-muted">Always simulate before signing</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div style="border-top: 1px solid var(--color-border); padding-top: var(--space-md);">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Email Notifications</p>
                            <p class="text-sm text-muted">Get notified of transactions</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div style="border-top: 1px solid var(--color-border); padding-top: var(--space-md);">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-medium">Hide Balances</p>
                            <p class="text-sm text-muted">Mask values on dashboard</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Guardians -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Guardians</h3>
                <button class="btn btn-ghost btn-sm" onclick="addGuardian()">+ Add</button>
            </div>
            <p class="text-secondary mb-lg">
                Guardians hold recovery shards and can help you regain access if you lose your device.
            </p>
            <div class="flex flex-col gap-md">
                <div class="flex items-center justify-between p-md"
                    style="background: var(--color-bg-glass); border-radius: var(--radius-md);">
                    <div class="flex items-center gap-md">
                        <div
                            style="width: 40px; height: 40px; background: var(--color-bg-tertiary); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center;">
                            üë§
                        </div>
                        <div>
                            <p class="font-medium">John D.</p>
                            <p class="text-sm text-muted">john@example.com</p>
                        </div>
                    </div>
                    <span class="badge badge-success">Confirmed</span>
                </div>

                <div class="flex items-center justify-between p-md"
                    style="background: var(--color-bg-glass); border-radius: var(--radius-md);">
                    <div class="flex items-center gap-md">
                        <div
                            style="width: 40px; height: 40px; background: var(--color-bg-tertiary); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center;">
                            üë§
                        </div>
                        <div>
                            <p class="font-medium">Sarah M.</p>
                            <p class="text-sm text-muted">sarah@example.com</p>
                        </div>
                    </div>
                    <span class="badge badge-success">Confirmed</span>
                </div>

                <div class="flex items-center justify-between p-md"
                    style="background: var(--color-bg-glass); border-radius: var(--radius-md);">
                    <div class="flex items-center gap-md">
                        <div
                            style="width: 40px; height: 40px; background: var(--color-bg-tertiary); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center;">
                            üë§
                        </div>
                        <div>
                            <p class="font-medium">Mike T.</p>
                            <p class="text-sm text-muted">mike@example.com</p>
                        </div>
                    </div>
                    <span class="badge badge-warning">Pending</span>
                </div>
            </div>
        </div>

        <!-- Danger Zone -->
        <div class="card" style="border: 1px solid var(--color-error);">
            <div class="card-header">
                <h3 class="card-title text-error">Danger Zone</h3>
            </div>
            <div class="flex gap-md">
                <button class="btn btn-secondary" onclick="exportData()">Export Data</button>
                <button class="btn btn-secondary text-error" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>
</div>

<style>
    /* Toggle Switch */
    .switch {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 28px;
        flex-shrink: 0;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--color-bg-tertiary);
        transition: var(--transition-fast);
        border-radius: var(--radius-full);
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: var(--transition-fast);
        border-radius: 50%;
    }

    input:checked+.slider {
        background: var(--color-accent-gradient);
    }

    input:checked+.slider:before {
        transform: translateX(20px);
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    function rotateKeys() {
        WhaleWallet.Toast.info('Key rotation requires mobile app confirmation');
    }

    function configureDuress() {
        WhaleWallet.Toast.info('Opening duress mode configuration...');
    }

    function pingInheritance() {
        WhaleWallet.Toast.success('Dead Man\'s Switch pinged successfully');
    }

    function configureInheritance() {
        WhaleWallet.Toast.info('Opening inheritance configuration...');
    }

    function addGuardian() {
        WhaleWallet.Toast.info('Opening guardian invitation...');
    }

    function exportData() {
        WhaleWallet.Toast.info('Preparing data export...');
    }

    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            WhaleWallet.API.clearToken();
            window.location.href = '/login';
        }
    }
</script>
{% endblock %}
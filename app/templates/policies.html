{% extends "base.html" %}

{% block title %}Policies - Whale Wallet{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <div class="page-eyebrow">POLICY · ENGINE · CONFIGURATION</div>
        <h1 class="page-title">Policies</h1>
        <p class="page-subtitle">Transaction rules and security policies</p>
    </div>
    <div class="page-actions">
        <button class="btn btn-primary" onclick="Modal.open('new-policy-modal')">Add Policy</button>
    </div>
</div>

<!-- Policy Stats -->
<div class="kpi-grid">
    <div class="kpi-card">
        <div class="kpi-value">4</div>
        <div class="kpi-label">Active Policies</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value">12</div>
        <div class="kpi-label">Blocked (30d)</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value">5</div>
        <div class="kpi-label">Whitelisted</div>
    </div>
    <div class="kpi-card">
        <div class="kpi-value">$2.4K</div>
        <div class="kpi-label">Daily Used</div>
        <div class="kpi-sub">of $10,000</div>
    </div>
</div>

<!-- Active Policies -->
<div class="card-label mb-md">Active Policies</div>
<div class="flex flex-col gap-md mb-xl">
    <div class="policy-card active">
        <div class="policy-info">
            <div class="policy-icon">VL</div>
            <div>
                <div class="policy-name">Daily Velocity Limit</div>
                <div class="policy-desc">Maximum $10,000 USD per 24-hour rolling window</div>
            </div>
        </div>
        <div class="policy-meta">
            <span class="badge badge-success">Active</span>
            <button class="btn btn-sm">Edit</button>
        </div>
    </div>

    <div class="policy-card active">
        <div class="policy-info">
            <div class="policy-icon">WL</div>
            <div>
                <div class="policy-name">Whitelist Only</div>
                <div class="policy-desc">Only allow transactions to pre-approved addresses</div>
            </div>
        </div>
        <div class="policy-meta">
            <span class="badge badge-success">Active</span>
            <button class="btn btn-sm">Edit</button>
        </div>
    </div>

    <div class="policy-card active">
        <div class="policy-info">
            <div class="policy-icon">TL</div>
            <div>
                <div class="policy-name">Large Transaction Time Lock</div>
                <div class="policy-desc">24-hour delay for transactions exceeding $50,000</div>
            </div>
        </div>
        <div class="policy-meta">
            <span class="badge badge-success">Active</span>
            <button class="btn btn-sm">Edit</button>
        </div>
    </div>

    <div class="policy-card active">
        <div class="policy-info">
            <div class="policy-icon">CV</div>
            <div>
                <div class="policy-name">Contract Verification</div>
                <div class="policy-desc">Block interactions with unverified smart contracts</div>
            </div>
        </div>
        <div class="policy-meta">
            <span class="badge badge-success">Active</span>
            <button class="btn btn-sm">Edit</button>
        </div>
    </div>
</div>

<!-- Whitelisted Addresses -->
<div class="card mb-xl">
    <div class="card-header">
        <span class="card-label">Whitelisted Addresses</span>
        <button class="btn btn-sm" onclick="Modal.open('add-address-modal')">Add Address</button>
    </div>
    <table class="data-table">
        <thead>
            <tr>
                <th>Label</th>
                <th>Address</th>
                <th>Chain</th>
                <th>Added</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Coinbase Hot Wallet</td>
                <td class="mono">0x71C7656EC7ab88b098defB751B7401B5f6d8976F</td>
                <td><span class="badge">ETH</span></td>
                <td style="color: var(--text-muted);">Jan 5, 2026</td>
                <td><button class="btn btn-sm" style="color: var(--state-error);">Remove</button></td>
            </tr>
            <tr>
                <td>Personal Ledger</td>
                <td class="mono">0x8894E0a0c962CB723c1976a4421c95949bE2D4E3</td>
                <td><span class="badge">ETH</span></td>
                <td style="color: var(--text-muted);">Jan 6, 2026</td>
                <td><button class="btn btn-sm" style="color: var(--state-error);">Remove</button></td>
            </tr>
            <tr>
                <td>Kraken</td>
                <td class="mono">bc1q84vlu8hswvxl0jqx3e0yxvj0m9x09w2k5k7f7w</td>
                <td><span class="badge">BTC</span></td>
                <td style="color: var(--text-muted);">Jan 8, 2026</td>
                <td><button class="btn btn-sm" style="color: var(--state-error);">Remove</button></td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Policy Simulator -->
<div class="card">
    <div class="card-header">
        <span class="card-label">Policy Simulator</span>
    </div>
    <p style="color: var(--text-secondary); margin-bottom: 20px;">Test how policies evaluate a hypothetical transaction
    </p>
    <form id="simulator-form"
        onsubmit="event.preventDefault(); document.getElementById('sim-result').style.display = 'block'; WhaleWallet.Toast.success('Simulation complete');">
        <div class="grid grid-3 mb-lg">
            <div class="form-group">
                <label class="form-label">Chain</label>
                <select class="form-input form-select">
                    <option>Ethereum</option>
                    <option>Bitcoin</option>
                    <option>Solana</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">To Address</label>
                <input type="text" class="form-input mono" placeholder="0x...">
            </div>
            <div class="form-group">
                <label class="form-label">Value (USD)</label>
                <input type="number" class="form-input" placeholder="5000">
            </div>
        </div>
        <button type="submit" class="btn">Evaluate Policies</button>
    </form>

    <div id="sim-result" style="display: none; margin-top: 20px;">
        <div class="card" style="background: var(--state-success-dim); border-color: var(--state-success);">
            <div class="flex items-center gap-md">
                <span style="font-size: 24px; color: var(--state-success);">✓</span>
                <div>
                    <div style="font-weight: 500; color: var(--state-success);">Transaction Allowed</div>
                    <div style="color: var(--text-secondary);">All policies passed.</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Policy Modal -->
<div class="modal-overlay" id="new-policy-modal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">Add Policy</span>
            <button class="modal-close" onclick="Modal.close('new-policy-modal')">×</button>
        </div>
        <form
            onsubmit="event.preventDefault(); WhaleWallet.Toast.success('Policy created'); Modal.close('new-policy-modal');">
            <div class="form-group">
                <label class="form-label">Policy Name</label>
                <input type="text" class="form-input" placeholder="e.g., Weekend Limit" required>
            </div>
            <div class="form-group">
                <label class="form-label">Policy Type</label>
                <select class="form-input form-select" required>
                    <option value="">Select type...</option>
                    <option value="velocity">Velocity Limit</option>
                    <option value="whitelist">Whitelist Only</option>
                    <option value="timelock">Time Lock</option>
                    <option value="timewindow">Time Window</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Configuration (JSON)</label>
                <textarea class="form-input form-textarea mono" placeholder='{"max_value_usd": 10000}'></textarea>
            </div>
            <div class="flex gap-md">
                <button type="button" class="btn" style="flex: 1;"
                    onclick="Modal.close('new-policy-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary" style="flex: 1;">Create Policy</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Address Modal -->
<div class="modal-overlay" id="add-address-modal">
    <div class="modal">
        <div class="modal-header">
            <span class="modal-title">Add Whitelisted Address</span>
            <button class="modal-close" onclick="Modal.close('add-address-modal')">×</button>
        </div>
        <form
            onsubmit="event.preventDefault(); WhaleWallet.Toast.success('Address added'); Modal.close('add-address-modal');">
            <div class="form-group">
                <label class="form-label">Label</label>
                <input type="text" class="form-input" placeholder="e.g., My Ledger" required>
            </div>
            <div class="form-group">
                <label class="form-label">Chain</label>
                <select class="form-input form-select" required>
                    <option value="ethereum">Ethereum</option>
                    <option value="bitcoin">Bitcoin</option>
                    <option value="solana">Solana</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Address</label>
                <input type="text" class="form-input mono" placeholder="0x..." required>
            </div>
            <div class="flex gap-md">
                <button type="button" class="btn" style="flex: 1;"
                    onclick="Modal.close('add-address-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary" style="flex: 1;">Add Address</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
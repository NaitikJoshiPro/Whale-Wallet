{% extends "base.html" %}

{% block title %}AI Concierge - Whale Wallet{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <div class="page-eyebrow">INTELLIGENCE · ADVISORY · SUPPORT</div>
        <h1 class="page-title">AI Concierge</h1>
        <p class="page-subtitle">Crypto wealth advisor powered by Claude</p>
    </div>
    <div class="page-actions">
        <button class="btn" onclick="clearChat()">Clear Chat</button>
    </div>
</div>

<div class="chat-container">
    <!-- Chat Messages -->
    <div class="chat-messages" id="chat-messages">
        <div class="chat-message ai">
            <div class="chat-avatar">AI</div>
            <div class="chat-bubble">
                <p style="margin-bottom: 12px;">Welcome to your AI Concierge. I can help with:</p>
                <ul style="margin-left: 16px; margin-bottom: 12px; color: var(--text-secondary);">
                    <li>Portfolio analysis and rebalancing</li>
                    <li>Security policy recommendations</li>
                    <li>Transaction risk assessment</li>
                    <li>Smart contract security reviews</li>
                </ul>
                <p>How can I assist you today?</p>
            </div>
        </div>

        <div class="chat-message user">
            <div class="chat-avatar">YOU</div>
            <div class="chat-bubble">
                What's the risk level if I interact with the Uniswap V3 router?
            </div>
        </div>

        <div class="chat-message ai">
            <div class="chat-avatar">AI</div>
            <div class="chat-bubble">
                <p style="font-weight: 500; margin-bottom: 12px;">Contract Analysis: Uniswap V3 Router</p>
                <div
                    style="padding: 12px; background: var(--state-success-dim); border-radius: 6px; margin-bottom: 12px;">
                    <span class="badge badge-success" style="margin-right: 8px;">Low Risk</span>
                    <span style="color: var(--state-success);">Verified Contract</span>
                    <div class="mono" style="font-size: 11px; margin-top: 8px; color: var(--text-muted);">
                        0x68b3465833fb72A70ecDF485E0e4C7bD8665Fc45</div>
                </div>
                <p style="font-weight: 500; margin-bottom: 8px;">Security Checks:</p>
                <ul style="margin-left: 16px; color: var(--text-secondary);">
                    <li style="color: var(--state-success);">✓ Source code verified on Etherscan</li>
                    <li style="color: var(--state-success);">✓ Audited by Trail of Bits, ABDK</li>
                    <li style="color: var(--state-success);">✓ No known vulnerabilities</li>
                    <li style="color: var(--state-success);">✓ Matches your whitelist policies</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Chat Input -->
    <div class="chat-input-area">
        <div class="chat-input-wrapper">
            <input type="text" id="chat-input" placeholder="Ask anything about your wallet, transactions, or crypto..."
                onkeypress="if(event.key === 'Enter') sendMessage()">
            <button class="btn btn-primary" onclick="sendMessage()">Send</button>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="grid grid-4 mt-xl">
    <div class="kpi-card" style="cursor: pointer;" onclick="sendSuggestion('Analyze my portfolio allocation')">
        <div class="kpi-label">Portfolio Analysis</div>
    </div>
    <div class="kpi-card" style="cursor: pointer;" onclick="sendSuggestion('What security policies should I add?')">
        <div class="kpi-label">Security Tips</div>
    </div>
    <div class="kpi-card" style="cursor: pointer;" onclick="sendSuggestion('Check if this address is safe')">
        <div class="kpi-label">Address Check</div>
    </div>
    <div class="kpi-card" style="cursor: pointer;" onclick="sendSuggestion('Explain MPC key rotation')">
        <div class="kpi-label">MPC Help</div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');

    function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) return;

        addMessage(message, 'user');
        chatInput.value = '';

        // Simulate AI response
        setTimeout(() => {
            const response = generateResponse(message);
            addMessage(response, 'ai');
        }, 1000);
    }

    function addMessage(content, type) {
        const msgHtml = `
        <div class="chat-message ${type}">
            <div class="chat-avatar">${type === 'ai' ? 'AI' : 'YOU'}</div>
            <div class="chat-bubble">${content}</div>
        </div>
    `;
        chatMessages.insertAdjacentHTML('beforeend', msgHtml);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function generateResponse(message) {
        const lower = message.toLowerCase();

        if (lower.includes('portfolio') || lower.includes('allocation')) {
            return `<p style="font-weight: 500; margin-bottom: 8px;">Portfolio Analysis</p>
            <p style="margin-bottom: 8px;">Current allocation:</p>
            <ul style="margin-left: 16px; color: var(--text-secondary);">
                <li>ETH: 80% ($987K) - <span style="color: var(--state-warning);">High concentration</span></li>
                <li>BTC: 12% ($150K) - Reasonable</li>
                <li>SOL: 4% ($50K) - Underweight</li>
                <li>Others: 4% ($47K)</li>
            </ul>
            <p style="margin-top: 12px;"><strong>Recommendation:</strong> Consider diversifying your ETH position to reduce single-asset risk.</p>`;
        }

        if (lower.includes('security') || lower.includes('policy')) {
            return `<p style="font-weight: 500; margin-bottom: 8px;">Security Recommendations</p>
            <ol style="margin-left: 16px; color: var(--text-secondary);">
                <li>Add geographic restriction policy</li>
                <li>Enable 2FA for transactions &gt;$25K</li>
                <li>Schedule key rotation (30 days overdue)</li>
            </ol>`;
        }

        return `<p>I understand you're asking about "${message.substring(0, 40)}..."</p>
        <p style="margin-top: 8px; color: var(--text-secondary);">I can help with portfolio analysis, security recommendations, transaction simulations, and general crypto questions.</p>`;
    }

    function sendSuggestion(text) {
        chatInput.value = text;
        sendMessage();
    }

    function clearChat() {
        chatMessages.innerHTML = `
        <div class="chat-message ai">
            <div class="chat-avatar">AI</div>
            <div class="chat-bubble">Chat cleared. How can I help you?</div>
        </div>
    `;
    }
</script>
{% endblock %}